<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Opanoma – v2 (Base)</title>
  <meta name="description" content="Base propre pour reconstruire le site, en gardant assets & API." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Fraunces:opsz,wght@9..144&display=swap" rel="stylesheet">
  <style>
    :root{ --paper:#fff; --ink:#1f1a1a; --muted:#6b5f5a; --accent:#a34d57; --beige:#f6efe8; --radius:16px; --container:1100px; --shadow:0 12px 40px rgba(0,0,0,.08); }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; line-height:1.6; color:var(--ink); background:var(--beige);} 
    .container{max-width:var(--container); margin-inline:auto; padding:24px;} 
    header{position:sticky; top:0; z-index:10; backdrop-filter:saturate(1.2) blur(8px); background:rgba(246,239,232,.8); border-bottom:1px solid rgba(0,0,0,.06)}
    header .row{display:flex; align-items:center; justify-content:space-between; gap:16px}
    a{color:inherit; text-decoration:none}
    .logo{font-weight:800; letter-spacing:.2px}
    .btn{display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:999px; border:1px solid rgba(0,0,0,.12); background:#fff; box-shadow:var(--shadow); font-weight:600}
    .hero{position:relative; min-height:62vh; display:grid; place-items:center; text-align:left; overflow:hidden; border-bottom:1px solid rgba(0,0,0,.08)}
    .hero::before{content:""; position:absolute; inset:0; background:linear-gradient(180deg, rgba(246,239,232,.0), rgba(246,239,232,.6) 60%, var(--beige) 100%);} 
    .hero .bg{position:absolute; inset:0; background-size:cover; background-position:center; filter:saturate(1.05) contrast(1.02);} 
    .hero .card{position:relative; z-index:1; background:rgba(255,255,255,.82); backdrop-filter:blur(8px); border:1px solid rgba(0,0,0,.06); border-radius:24px; padding:28px; box-shadow:var(--shadow); max-width:720px}
    .mega{font-family:Fraunces,serif; line-height:1.1; font-size:clamp(36px,6vw,56px); margin:0 0 8px}
    .sub{margin:0 0 16px; color:#4b403d}
    .grid{display:grid; gap:16px; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); margin-top:12px}
    .card{background:#fff; border:1px solid rgba(0,0,0,.06); border-radius:16px; padding:16px; box-shadow:var(--shadow)}
    footer{padding:32px 0; color:#635851}
    .tag{display:inline-block; font-size:12px; padding:4px 10px; border-radius:999px; background: #fff; border:1px solid rgba(0,0,0,.08)}
    .visually-hidden{position:absolute!important; height:1px;width:1px; overflow:hidden; clip:rect(1px,1px,1px,1px)}
  </style>
</head>
<body>
  <header>
    <div class="container row">
      <div class="logo">Opanoma</div>
      <nav class="actions">
        <a class="btn" href="#newsletter">La carte de la semaine</a>
        <a class="btn" href="#reserver">Réserver</a>
      </nav>
    </div>
  </header>

  <section class="hero" id="top">
    <div class="bg" style="background-image:url('/assets/img/hero/01.png'), linear-gradient(120deg,#e8d8cf,#f6efe8);"></div>
    <div class="container">
      <div class="card">
        <p class="tag">Base v2</p>
        <h1 class="mega">Au cœur du monde<br>São Tomé &amp; Príncipe</h1>
        <p class="sub">Reconstruction propre. On garde vos images, vos APIs, et on ajoute chaque bloc pas à pas.</p>
        <div class="grid">
          <a class="btn" href="#newsletter">Activer la newsletter</a>
          <a class="btn" href="#modules">Voir les modules</a>
        </div>
      </div>
    </div>
  </section>

  <main class="container" id="modules">
    <h2>Modules à réintégrer</h2>
    <div class="grid">
      <div class="card" id="newsletter">
        <h3>Newsletter – “La carte de la semaine”</h3>
        <p>Placeholder d’intégration MailerLite. Remplacez l’ID par le vôtre.</p>
        <div class="ml-embedded" data-form="c3W8BT"></div>
      </div>
      <div class="card" id="reserver">
        <h3>Réserver</h3>
        <p>Placeholder d’intégration Cal.com → colle ici votre widget.</p>
        <div id="calcom"></div>
      </div>
      <div class="card" id="tarot">
        <h3>Tirage hebdomadaire (API)</h3>
        <p>Ce bloc appellera votre endpoint existant pour générer 1 carte / semaine.</p>
        <pre id="tarot-log">Prêt.</pre>
      </div>
    </div>
  </main>

  <footer class="container">
    <small>© <span id="y"></span> Opanoma — v2 base propre.</small>
  </footer>

  <script>
    // --- Configuration centrale (modifiez ici si besoin)
    window.APP_CONFIG = window.APP_CONFIG || {};
    // Détecte localhost vs prod et permet override rapide
    const hostname = location.hostname;
    APP_CONFIG.API_URL = APP_CONFIG.API_URL || (
      hostname === 'localhost' || hostname.startsWith('127.')
        ? 'http://localhost:3000/api/tarot/summarize'
        : 'https://opanoma.fr/api/tarot/summarize'
    );
    // MailerLite (placeholder) et Cal.com (placeholder)
    APP_CONFIG.MAILERLITE_FORM_ID = 'c3W8BT';
    APP_CONFIG.CALCOM_EMBED = ''; // ex: '<iframe ...></iframe>'

    // --- Utilitaires
    const $ = (sel, el=document)=>el.querySelector(sel);

    // Année footer
    $('#y').textContent = new Date().getFullYear();

    // Rendre Cal.com si fourni
    if (APP_CONFIG.CALCOM_EMBED) {
      $('#calcom').innerHTML = APP_CONFIG.CALCOM_EMBED;
    }

    // Sécu image hero: si l'image 01.png ne charge pas, on garde le dégradé
    (function testHero(){
      const bg = $('.hero .bg');
      const url = '/assets/img/hero/01.png';
      const img = new Image();
      img.onload = ()=>{ /* ok */ };
      img.onerror = ()=>{ bg.style.backgroundImage = 'linear-gradient(120deg,#e8d8cf,#f6efe8)'; };
      img.src = url + '?v=' + Date.now();
    })();

    // --- Démo: appel API (1 carte) si endpoint répond
    (async function demoTarot(){
      try {
        const res = await fetch(APP_CONFIG.API_URL, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({
            question: 'Tirage hebdo (démo)',
            cards: [{ position:'Semaine', name:'Le Bateleur', number:1, reversed:false, upright:[], reversed_kw:[] }]
          })
        });
        const data = await res.json();
        $('#tarot-log').textContent = data?.text || JSON.stringify(data);
      } catch (e) {
        $('#tarot-log').textContent = 'API non joignable pour le moment → vérifier APP_CONFIG.API_URL';
      }
    })();
  </script>
</body>
</html>
