<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>l’Œil d’Opanoma</title>

  <!-- Polices -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Mrs+Sheppards&display=swap" rel="stylesheet">



  <style>
 :root{
  --beige:#f6efe8; --ink:#1f1a1a; --line:rgba(0,0,0,.08);
  --accent:#a34d57; --shadow:0 12px 40px rgba(0,0,0,.08);
  --container:1100px;

  /* tailles mini/maxi des icônes décoratives */
  --icon-min: 24px;
  --icon-max: 68px;
}

  *{ box-sizing:border-box }
  html,body{ margin:0; padding:0 }
  html { scroll-behavior: smooth; }
  body{ font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; color:var(--ink); background:var(--beige) }

 /* ===== Topbar (mobile-safe) ===== */
:root{
  --topbar-h: clamp(56px, 8vh, 72px);
  --pad: clamp(12px, 2.8vw, 20px);
}

/* Barre collante + flou + safe-area */
.topbar{
  position: sticky;
  top: 0;
  z-index: 1000;
  background: rgba(246,239,232,.85);
  -webkit-backdrop-filter: saturate(1.1) blur(8px);
  backdrop-filter: saturate(1.1) blur(8px);
  border-bottom: 1px solid var(--line);

  min-height: calc(var(--topbar-h) + env(safe-area-inset-top));
  padding-top: calc(env(safe-area-inset-top) / 2 + 6px);
}

/* Contenu centré comme chez toi */
.topbar__row{
  max-width: var(--container);
  margin: 0 auto;
  padding: 14px 24px;
  display: grid; align-items: center; gap: 16px;
  grid-template-columns: 1fr auto 1fr;
}

.brand{ display: inline-flex; align-items: center; gap: 10px; font-weight: 800; }
.brand img{ height: 30px; width: auto; display: block; border-radius: 6px; }
.brand__name{ letter-spacing: .2px; white-space: nowrap; }

/* Nav centrale */
.nav{ display: flex; align-items: center; gap: 12px; justify-self: center; }

/* Boutons : tap-target confort */
.btn{
  display: inline-flex; align-items: center; gap: 8px;
  padding: 9px 14px; border-radius: 999px; font-weight: 600;
  background: #fff; color: var(--ink);
  border: 1px solid rgba(0,0,0,.12); box-shadow: var(--shadow);
  text-decoration: none; transition: transform .12s ease; white-space: nowrap;

  /* ≥ 44px pour éviter le double-tap zoom */
  min-height: 44px; min-width: 44px;
}
.btn:hover{ transform: translateY(-1px); }
.nav__week{ margin-left: 18px; }

/* Réseaux */
.socials{ justify-self: end; display: flex; align-items: center; gap: 10px; }
.icon{
  width: 36px; height: 36px; display: inline-flex; align-items: center; justify-content: center;
  color: #111; text-decoration: none; border-radius: 8px; transition: transform .12s ease;
}
.icon:hover{ transform: translateY(-1px); }
.icon svg{ filter: invert(1) drop-shadow(0 0 1px rgba(0,0,0,.55)); opacity: .95; }

/* Fallback si blur non supporté */
@supports not ((backdrop-filter: blur(4px)) or (-webkit-backdrop-filter: blur(4px))){
  .topbar{ background: rgba(246,239,232,.98); }
}

/* Réduire transparence si préférence utilisateur */
@media (prefers-reduced-transparency: reduce){
  .topbar{
    -webkit-backdrop-filter: none; backdrop-filter: none;
    background: #f6efe8;
  }
}

/* Mobile */
@media (max-width: 720px){
  .topbar__row{ grid-template-columns: 1fr auto; }
  .socials{ display: none; }
  .nav__week{ margin-left: 8px; }
  .brand__name{ font-size: 14px; }
}

/* IMPORTANT : évite que le contenu passe sous la topbar */
main, .page, #app{
  padding-top: calc(var(--topbar-h) + env(safe-area-inset-top));
}

  






  
    /* curseur qui clignote pendant la frappe */
#reading-output.typing::after {
  content: "▍";
  margin-left: 2px;
  animation: blink 1s steps(1) infinite;
}
@keyframes blink { 50% { opacity: 0; } }


.modal__close{ display:none !important; }

  
  /* Images des cartes tirées (bande du bas) */
#api-picks .result-card-inner img{
  width: 100%;
  height: 100%;
  object-fit: contain; /* montre toute l’image sans rognage */
  display: block;      /* enlève l’espace baseline */
}

  /* Boutons tirage désactivés */
#tirage-ia .modes .mode[disabled]{
  opacity:.5;
  cursor:not-allowed;
}

.interpret-actions {
  display: flex;
  gap: 12px;
  margin-top: 16px;
  justify-content: flex-end; /* boutons à droite */
}

.interpret-actions .btn.mode {
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:9px 14px;
  border-radius:999px;
  font-weight:600;
  background:#fff;
  color:var(--ink);
  border:1px solid rgba(0,0,0,.12);
  box-shadow:var(--shadow);
  cursor:pointer;
  transition:transform .12s ease;
}

.interpret-actions .btn.mode:hover {
  transform:translateY(-1px);
}

.interpret-actions .btn.mode:active {
  transform:translateY(0);
}

/* AJOUTE dans ton <style> */
.interpret-actions { display:none; }
.interpret-actions.is-visible { display:flex; }

#tirage-ia .themes .theme,
#tirage-ia .modes .mode {
  font-family: 'Inter', cursive;
  font-size: 0.95rem;       /* un peu plus gros pour la lisibilité */
  font-weight: 400;        /* pas besoin de bold, elle est déjà expressive */
}




/* Boutons thèmes (même style que boutons tirage) */
#tirage-ia .themes .theme {
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:9px 14px;
  border-radius:999px;
  font-weight:600;
  background:#fff;
  color:var(--ink);
  border:1px solid rgba(0,0,0,.12);
  box-shadow:var(--shadow);
  cursor:pointer;
  transition: transform .12s ease;
}
#tirage-ia .themes .theme:hover {
  transform: translateY(-1px);
}
#tirage-ia .themes .theme.active {
  background: var(--accent);
  color:#fff;
  border-color:transparent;
}
#tirage-ia .themes .theme:focus-visible {
  outline:2px solid var(--accent);
  outline-offset:2px;
}






/* Petit shake visuel pour attirer l’œil sur les thèmes */
@keyframes tarot-shake {
  10%, 90% { transform: translateX(-1px); }
  20%, 80% { transform: translateX(2px); }
  30%, 50%, 70% { transform: translateX(-4px); }
  40%, 60% { transform: translateX(4px); }
}
.themes.shake { animation: tarot-shake .4s linear 1; }

  
  /* Boutons de tirage */
#tirage-ia .modes{ display:flex; flex-wrap:wrap; gap:8px; }
#tirage-ia .modes .mode{
  display:inline-flex; align-items:center; gap:6px;
  padding:9px 14px; border-radius:999px; font-weight:600;
  background:#fff; color:var(--ink);
  border:1px solid rgba(0,0,0,.12); box-shadow:var(--shadow);
  cursor:pointer;
}
#tirage-ia .modes .mode.active{
  background: var(--accent); color:#fff; border-color:transparent;
}
#tirage-ia .modes .mode:focus-visible{ outline:2px solid var(--accent); outline-offset:2px; }

/* Style du titre du popup tirage */
#tirage-modal .modal__head {
  justify-content: center;       /* centre horizontalement */
}








/* verrou visuel quand pas prêt */
#tarot-grid.disabled{ pointer-events:none; opacity:.55; }

  
  #tarot-grid .tarot-card .flip {
  aspect-ratio: 2 / 3;   /* structure */
  min-height: 140px;     /* garde la carte visible même si l'image tarde */
  display: block;
}
#tarot-grid .tarot-card { width: 100%; }
#tarot-grid .tarot-card .side img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  display: block;
}

  
  
  /* ===== Tarot: grille + cartes ===== */
#tarot-grid.grid{
  display:grid;
  gap:12px;
  grid-template-columns:repeat(auto-fill, minmax(90px,1fr));
}

.tarot-card{
  position:relative;
  border:0; padding:0; background:none;
  cursor:pointer;
  perspective:800px;
}
.tarot-card .flip{
  position:relative;
  width:100%;
  aspect-ratio:2/3;           /* donne la hauteur → indispensable */
  transform-style:preserve-3d;
  transition:transform .5s ease;
}
.tarot-card[data-flipped="1"] .flip{ transform:rotateY(180deg); }

.tarot-card .side{
  position:absolute; inset:0;
  backface-visibility:hidden;
  border-radius:10px; overflow:hidden;
  border:1px solid rgba(0,0,0,.08);
  box-shadow:var(--shadow);
  background:#fff;
}
.tarot-card .side.front{ transform:rotateY(180deg); }
.tarot-card .side img{
  width:100%; height:100%; object-fit:contain; display:block;
}


.chosen-theme { font-weight:600; margin-bottom:6px; }
.q-tools { display:flex; justify-content:space-between; align-items:center; margin-top:6px; }


/* Bande des résultats */
#api-picks{
  display:flex; justify-content:center; align-items:flex-start;
  gap:12px; margin-top:16px; overflow-x:auto; padding-bottom:4px; width:100%;
}
#api-picks .result-card{ flex:0 0 var(--pick-w,96px); width:var(--pick-w,96px); }
#api-picks .result-card-inner{
  width:100%; aspect-ratio:2/3; overflow:hidden; border-radius:10px;
  border:1px solid rgba(0,0,0,.08); box-shadow:var(--shadow); background:#fff;
}
#api-picks .pick-tag{ margin-bottom:6px; text-align:center; font:700 12px/1.2 Inter,system-ui,sans-serif; color:var(--accent); }
#api-picks .pick-kw{ margin-top:6px; text-align:center; font-weight:700; font-size:11px; line-height:1.25; color:#6b5f5a; }
#api-picks .pick-kw span{ display:block; }


  /* ===== Titre de la modale + aide ===== */
  .modal__titlewrap{
    display:flex; align-items:center; gap:10px; flex-wrap:wrap;
  }
  .modal__hint{
    font:600 13px/1.3 Inter,system-ui,sans-serif;
    color:#6b5f5a;
    white-space:nowrap;
  }
  @media (max-width:640px){
    .modal__hint{ white-space:normal }
  }

  /* Optionnel mais utile pour le wrapping */
  #interp-text {
    white-space: pre-wrap;
    line-height: 1.6;
    overflow-wrap: anywhere;
  }

  



  #reading-output.loading{ opacity:.8 }
  #reading-output .loader{
    display:flex; align-items:center; gap:10px;
    padding:10px 12px; border-radius:12px; background:#fff;
    border:1px solid rgba(0,0,0,.06); box-shadow:var(--shadow);
  }
  #reading-output .spinner{
    width:18px; height:18px; border-radius:50%;
    border:3px solid rgba(163,77,87,.25);
    border-top-color: var(--accent);
    animation: tarot-spin .9s linear infinite;
  }
  @keyframes tarot-spin { to { transform: rotate(360deg); } }

  /* ===== Cal.com ===== */
  #calframe { width:100%; min-height:650px; border:0; border-radius:12px; }
  #reserver { display:none; }
  :target { scroll-margin-top: 80px; } /* si header sticky */

  /* adapte les sélecteurs à ta structure */
  .site-header .brand a,
  .site-header .brand a:visited {
    color: var(--ink, #1f1a1a) !important;
    text-decoration: none;
  }
  .site-header .brand a:hover { color: var(--accent, #a34d57); }

  /* mêmes règles que Offres/Tarifs, Avis, Réserver */
  .card-section {
    background: var(--beige, #f6efe8);
    padding: 40px 20px;
    border-radius: 12px;
    box-shadow: var(--shadow, 0 10px 30px rgba(0,0,0,.08));
    margin: 40px auto;
    max-width: 960px;
    text-align: center;
  }

  .card-section h2 {
    font-family: "Fraunces", serif;
    font-size: 1.8rem;
    margin-bottom: 0.5em;
    color: var(--ink, #1f1a1a);
  }

  .card-section p {
    margin-bottom: 1.5em;
    color: #444;
  }

  /* Offres cliquables */
  .card[data-cal] { cursor:pointer; }
  .card[data-cal]:focus-visible { outline:2px solid var(--accent); outline-offset:2px; }

  /* ===== Hero ===== */
  .hero{
    position:relative; min-height:62vh;
    display:grid; place-items:center; text-align:left; overflow:hidden;
    border-bottom:1px solid rgba(0,0,0,.08);
  }
  .hero::before{
    content:""; position:absolute; inset:0;
    background:linear-gradient(180deg, rgba(246,239,232,0), rgba(246,239,232,.6) 60%, var(--beige) 100%);
    pointer-events:none;
  }
  .hero .bg{ position:absolute; inset:0; background-size:cover; background-position:center; filter:saturate(1.05) contrast(1.02) }
  .hero .card{
    position:relative; z-index:1; background:rgba(255,255,255,.82); backdrop-filter:blur(8px);
    border:1px solid rgba(0,0,0,.06); border-radius:24px; padding:28px; box-shadow:var(--shadow); max-width:560px;
  }
  .tag{ display:inline-block; font-size:12px; padding:4px 10px; border-radius:999px; background:#fff; border:1px solid rgba(0,0,0,.08) }
  .mega{ font-weight:800; line-height:1.15; font-size:clamp(32px,5vw,48px); margin:0 0 8px }
  .sub{ margin:0 0 16px; color:#4b403d }
  .hero .grid{ display:grid; gap:16px; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); }
  @media (max-width:560px){ .hero .card{ padding:20px; border-radius:18px } }
  
  
  .mega {
  font-family: 'Cinzel Decorative', serif;
  font-weight: 700;
  line-height: 1.15;
  font-size: clamp(32px, 5vw, 48px);
  margin: 0 0 8px;
  text-align: center; /* optionnel si tu veux centré */
}

  

  /* ===== Sections génériques ===== */
  .wrap{ max-width:var(--container); margin:0 auto; padding:24px }
  .grid-3{ display:grid; gap:16px; grid-template-columns:repeat(3, 1fr) }
  @media (max-width:900px){ .grid-3{ grid-template-columns:repeat(2,1fr) } }
  @media (max-width:600px){ .grid-3{ grid-template-columns:1fr } }

  .card{
    background:#fff; border:1px solid rgba(0,0,0,.06);
    border-radius:16px; padding:16px; box-shadow:var(--shadow);
    transition: transform .25s ease, box-shadow .25s ease, border-color .25s ease;
    cursor:pointer;
  }
  @media (hover:hover){
    .card:hover{
      transform: translateY(-6px) scale(1.02);
      box-shadow: 0 16px 50px rgba(163,77,87,0.25);
      border-color: var(--accent);
    }
  }
  .card:active{
    transform: translateY(0) scale(0.98);
    box-shadow: 0 6px 20px rgba(163,77,87,0.2);
    border-color: var(--accent);
    background: rgba(255,255,255,0.95);
  }

  
  #newsletter { max-width: 600px; margin: 0 auto; padding: 40px 20px; }
  .ml-embedded form { background: transparent !important; }

  /* ===== Newsletter ===== */
  #newsletter .card{ display:grid; grid-template-columns: 120px 1fr; gap:16px; align-items:center; }
  #newsletter .thumb{ width:100%; aspect-ratio:1/1; border-radius:12px; overflow:hidden; border:1px solid rgba(0,0,0,.06); box-shadow:var(--shadow); background:#fff; }
  #newsletter .thumb img{ width:100%; height:100%; object-fit:cover; }
  @media (max-width:640px){ #newsletter .card{ grid-template-columns:1fr } }
  </style>

  <!-- Styles MailerLite -->
  <style type="text/css">@import url("https://assets.mlcdn.com/fonts.css?version=1755079");</style>
  <style type="text/css">
    /* LOADER */
    .ml-form-embedSubmitLoad {
      display: inline-block;
      width: 20px;
      height: 20px;
    }

    .g-recaptcha {
      transform: scale(1);
      -webkit-transform: scale(1);
      transform-origin: 0 0;
      -webkit-transform-origin: 0 0;
     
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0,0,0,0);
      border: 0;
    }

    .ml-form-embedSubmitLoad:after {
      content: " ";
      display: block;
      width: 11px;
      height: 11px;
      margin: 1px;
      border-radius: 50%;
      border: 4px solid #fff;
      border-color: #ffffff #ffffff #ffffff transparent;
      animation: ml-form-embedSubmitLoad 1.2s linear infinite;
    }
    @keyframes ml-form-embedSubmitLoad { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

/* Verrouille l’accent en bordeaux dans la zone newsletter */
#newsletter { --accent: #a34d57 !important; }


/* ===== Newsletter sexy ===== */
#newsletter.card-section {
  padding: 64px 20px;
  background:
    radial-gradient(1200px 400px at 20% -10%, rgba(163,77,87,0.10), transparent 60%),
    radial-gradient(900px 300px at 80% 110%, rgba(163,77,87,0.08), transparent 60%),
    linear-gradient(135deg, #f6efe8, #e8d8cf);
}

#newsletter .container {
  max-width: 720px;
  margin: 0 auto;
  background: #fff;
  border: 1px solid rgba(0,0,0,.06);
  border-radius: 24px;
  box-shadow: 0 16px 44px rgba(163,77,87,0.18);
  padding: 32px 28px;
  text-align: center;
}

/* Titres */
#newsletter h4 {
  margin: 0 0 6px;
  font-size: 0.95rem;
  letter-spacing: .08em;
  text-transform: uppercase;
  color: #7a6a66;
}

#newsletter h2 {
  margin: 0 0 10px;
  font-family: 'Cinzel Decorative', serif;
  font-weight: 700;
  font-size: clamp(24px, 4.2vw, 34px);
  color: var(--accent, #a34d57);
}

#newsletter p {
  margin: 0 0 18px;
  color: #4b403d;
  line-height: 1.6;
}

/* Bloc MailerLite : harmonisation douce */
#newsletter .ml-form-embedContainer {
  margin-top: 12px;
}

#newsletter .ml-form-embedBody .ml-form-formContent,
#newsletter .ml-form-embedBody .ml-form-fieldRow,
#newsletter .ml-form-embedBody .ml-field-group {
  display: flex;
  gap: 10px;
  align-items: center;
  justify-content: center;
}

/* Champ email */
#newsletter input.form-control[type="email"] {
  flex: 1 1 340px;
  max-width: 420px;
  height: 48px;
  padding: 0 14px;
  border-radius: 12px;
  border: 1px solid #d8cfc9;
  background: #fff;
  font-size: 16px;
  transition: box-shadow .2s ease, border-color .2s ease;
}
#newsletter input.form-control[type="email"]:focus {
  outline: none;
  border-color: var(--accent, #a34d57);
  box-shadow: 0 0 0 4px rgba(163,77,87,0.15);
}

/* Bouton */
#newsletter .ml-form-embedSubmit .primary {
  height: 40px;                 /* plus petit que 48px */
  padding: 0 12px;              /* moins large */
  font-size: 0.9rem;            /* texte réduit */
  margin-top: 16px;             /* décale vers le bas */
  
  border: 0;
  border-radius: 10px;          /* tu peux aussi réduire l’arrondi */
  background: var(--accent, #a34d57);
  color: #fff;
  font-weight: 600;             /* un peu plus léger que 700 */
  letter-spacing: .02em;
  cursor: pointer;
  transition: transform .15s ease, box-shadow .2s ease, opacity .2s ease;
}


#newsletter .ml-form-embedSubmit .primary:hover {
  transform: translateY(-1px);
  box-shadow: 0 10px 26px rgba(163,77,87,0.28);
}
#newsletter .ml-form-embedSubmit .primary:active {
  transform: translateY(0);
  box-shadow: 0 4px 14px rgba(163,77,87,0.18);
}

/* Success */
#newsletter .ml-form-successBody {
  background: #fff;
  border: 1px solid rgba(0,0,0,.06);
  border-radius: 18px;
  padding: 20px;
  box-shadow: 0 10px 24px rgba(163,77,87,0.12);
}

/* Responsive */
@media (max-width: 560px) {
  #newsletter .container { 
    padding: 24px 18px; 
    border-radius: 20px; 
  }
  #newsletter .ml-form-embedBody .ml-form-formContent,
  #newsletter .ml-form-embedBody .ml-form-fieldRow { 
    flex-direction: column; 
  }
  #newsletter input.form-control[type="email"] { width: 100%; }
  #newsletter .ml-form-embedSubmit .primary { width: 100%; }
}




#tirage-ia {
  position: relative;
  overflow: hidden;
  background: transparent !important; /* enlève le beige */
}

#tirage-ia .bg-video {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;   /* la vidéo remplit tout */
  z-index: 0;
  opacity: 1;       /* règle la transparence du fond animé */
  pointer-events: none; /* la vidéo n’intercepte pas les clics */
}

#tirage-ia .tirage-content {
  position: relative;
  z-index: 1; /* contenu toujours au-dessus de la vidéo */
}


   
   /* Couleur uniquement autour de la zone tirage (dans la modale) */
.modal[open] #tirage-ia .card{
  background: transparent;
}

 .modal[open] #tarot-grid{
  background: transparent;  /* ✅ plus de fond */
  border-radius: 12px;
  padding: 12px;
}

.modal[open] #tirage-ia {
  background: transparent !important;
}


/* Look normal, mais verrou technique */
.modal[open] #tarot-grid.disabled{
  opacity: 1 !important;
  pointer-events: none !important;
}
.modal[open] #tarot-grid.disabled .tarot-card{ cursor: not-allowed; }


/* ===== Madame IA (titre décoré, responsive) ===== */
#madame-ia-title{
  position: relative;
  display: block;
  text-align: center;
  font-family: 'Cinzel Decorative', serif;
  font-weight: 700;
  line-height: 1.2;
  margin: 32px auto 20px;

  /* tailles mini/maxi et icône responsive */
  --icon-min: 24px;
  --icon-max: 68px;
  --icon: clamp(var(--icon-min), 6vw, var(--icon-max));

  /* taille du titre responsive */
  font-size: clamp(1.6rem, 4vw, 1.8rem);

  /* espace pour ne pas chevaucher */
  padding-left:  calc(var(--icon) + 1ch);
  padding-right: calc(var(--icon) + 1ch);

  /* icônes gauche/droite */
  background-image:
    url('/assets/img/iapic/ESO2.png'),
    url('/assets/img/iapic/ESO2.png');
  background-repeat: no-repeat, no-repeat;
  background-position:
    left 0.5ch center,
    right 0.5ch center;
  background-size:
    var(--icon) var(--icon),
    var(--icon) var(--icon);
}

@media (max-width: 520px){
  #madame-ia-title{
    font-size: 1.6rem; /* optionnel: plus petit sur mobile */
  }
}


/* ===== Lecture IA lisible sur fond vidéo + reflet ===== */
#tirage-modal #reading-output {
  /* lisibilité & paragraphes */
  white-space: pre-wrap;
  line-height: 1.6;
  overflow-wrap: anywhere;

  /* style visuel */
  color: #d4af37 !important;                 /* doré lisible */
  background: rgba(255,255,255,0.08);        /* léger voile */
  padding: 12px;
  border-radius: 8px;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.6);
  position: relative;                         /* nécessaire pour ::after */
}

/* reset anti-dégradés hérités (conserve la couleur ci-dessus) */
#tirage-modal #reading-output * {
  background: none !important;
  -webkit-background-clip: initial !important;
  background-clip: initial !important;
  -webkit-text-fill-color: initial !important;
  -webkit-text-stroke: 0 !important;
  mix-blend-mode: normal !important;
  opacity: 1 !important;
  color: inherit !important;
}

/* Reflet animé */
#reading-output::after {
  content: "";
  position: absolute;
  top: 0;
  left: -50%;
  width: 50%;
  height: 100%;
  pointer-events: none;
  background: linear-gradient(
    120deg,
    transparent 0%,
    rgba(255, 255, 255, 0.35) 50%,
    transparent 100%
  );
  transform: skewX(-20deg);
  animation: shine 4s infinite;
}

@keyframes shine {
  0%   { left: -50%; }
  40%  { left: 120%; }
  100% { left: 120%; }
}








#tirage-modal #ia-reading #read-title {
  color: #fff !important;
}




#newsletter h2 {
  font-family: 'Cinzel Decorative', serif; /* la même que les Avis */
  font-weight: 700; 
  font-size: 2rem; /* adapte si besoin */
  text-align: center;
  margin-bottom: 1rem;
}




 
   


    
   


    
/* ===== POPUP SOLID ===== */
.modal{position:fixed; inset:0; z-index:2000; display:none;}
.modal[open]{display:grid; place-items:center;}

.modal__overlay{position:absolute; inset:0; background:rgba(0,0,0,.45); backdrop-filter:blur(2px);}

.modal__panel {
  position: relative;
  display: flex;
  flex-direction: column;
  width: min(96vw, 1100px);
  height: min(92vh, 900px);
  border: 1px solid rgba(0,0,0,.08);
  border-radius: 20px;
  box-shadow: 0 12px 40px rgba(0,0,0,.25);

  background: transparent !important;  /* ✅ vidéo visible derrière */
  overflow: hidden;                    /* ✅ clippe la vidéo */
}

/* vidéo de fond dans la modale */
.modal__panel .panel-bg {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  z-index: 0;
  opacity: 1;             /* mets 0.5 si tu veux translucide */
  pointer-events: none;   /* ne bloque pas les clics */
}

.modal__head {
  flex: 0 0 auto;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  padding: 12px 16px;
  border-bottom: 1px solid var(--line, rgba(0,0,0,.08));
  background: #fff7;

  position: relative; /* ✅ au-dessus de la vidéo */
  z-index: 1;
}

.modal__content {
  flex: 1 1 auto;
  min-height: 0;           /* ✅ nécessaire pour que le scroll fonctionne */
  overflow: auto;          /* ✅ contenu scrollable */
  padding: 16px;
  display: block !important;

  position: relative; /* ✅ au-dessus de la vidéo */
  z-index: 1;
}



/* Ligne thèmes + question */
.themes-row {
  display: grid;
  grid-template-columns: auto 1fr; /* colonne gauche (thèmes + modes) | colonne droite (question) */
  column-gap: 16px;
  align-items: start;
}

/* Placements dans la grille */
.themes         { grid-column: 1; grid-row: 1; }
.modes          { grid-column: 1; grid-row: 2; margin-top: 8px; }
#theme-question { grid-column: 2; grid-row: 1 / span 2; min-width: 260px; }

/* Styles boutons */
.themes .theme,
.modes .mode {
  display: inline-block;
  padding: 6px 14px;
  font-size: 14px;
  line-height: 1.2;
  border: 1px solid #aaa;
  border-radius: 6px;
  background: #f8f8f8;
  cursor: pointer;
}

/* Boutons thèmes sur une seule ligne (wrap si écran petit) */
.themes { display: flex; flex-wrap: wrap; gap: 8px; }

/* Outils question */
.q-tools { display:flex; justify-content:space-between; align-items:center; margin-top:6px; }
.chosen-theme { font-weight:600; margin-bottom:6px; }


/* Les boutons thème restent flex et wrap */
#tirage-ia .themes{
  display:flex; flex-wrap:wrap; gap:8px;
}

/* La question en inline (label + champ sur la même ligne) */
#tirage-ia #theme-question[hidden]{ display:none !important; }
#tirage-ia #theme-question{ background:#fff; border:1px solid rgba(0,0,0,.08); box-shadow:var(--shadow);
  border-radius:12px; padding:10px; }
#tirage-ia #theme-question .q-inline{
  display:flex; align-items:center; gap:8px;
}
#tirage-ia #theme-question .q-label{
  font:600 12px/1.2 Inter,system-ui,sans-serif; color:#6b5f5a; white-space:nowrap;
}
#tirage-ia #theme-question textarea{
  flex:1; width:100%; min-height:38px; resize:vertical; padding:8px 10px;
  border:1px solid rgba(0,0,0,.12); border-radius:8px; background:#fff;
}
#tirage-ia #theme-question .q-tools{
  display:flex; justify-content:space-between; align-items:center; margin-top:6px;
}

/* Responsive : pile sur mobile */
@media (max-width: 800px){
  #tirage-ia .themes-row{ grid-template-columns: 1fr; }
}

/* ===== Titre de la modale de tirage (décoré, responsive) ===== */
#tirage-modal .modal__title {
  position: relative;
  display: block;
  text-align: center;
  margin: 0;

  font-family: 'Cinzel Decorative', serif;
  font-weight: 700;

  /* taille d’icône responsive */
  --icon: clamp(var(--icon-min), 6vw, var(--icon-max));

  /* titre responsive */
  font-size: clamp(1.75rem, 4.5vw, 2rem);

  /* espace pour ne pas chevaucher */
  padding-left:  calc(var(--icon) + 1ch);
  padding-right: calc(var(--icon) + 1ch);

  /* icônes gauche/droite → 3cartes.webp */
  background-image:
    url('/assets/img/iapic/3cartes.webp'),
    url('/assets/img/iapic/3cartes.webp');
  background-repeat: no-repeat, no-repeat;
  background-position:
    left 0.5ch center,
    right 0.5ch center;
  background-size:
    var(--icon) var(--icon),
    var(--icon) var(--icon);
}







#ia-title {
  font-family: 'Roboto Condensed', sans-serif;
  font-size: 1.2rem;     /* texte plus grand */
  font-weight: 500;
  color: #fff;           /* blanc */
  text-align: center;
  margin: 2px 0 20px;    /* ⇦ réduit le haut → ça remonte */
  line-height: 0.5;
}

#ia-title span {
  display: inline-block;
  margin: 0 10px;        /* espace entre chaque étape */
}






/* Neutralise le beige de la modale */
#tirage-modal .modal__panel {
  background: transparent !important;
}

/* Neutralise le beige du conteneur tirage */
#tirage-modal #tirage-ia {
  background: transparent !important;
}

/* Si besoin, neutralise aussi les cartes de tirage elles-mêmes */
#tirage-modal #tirage-ia .card {
  background: transparent !important;
  box-shadow: none; /* optionnel, si tu veux que les cadres disparaissent totalement */
}

/* Conserver les sauts de ligne dans l'interprétation */
#reading-output {
  white-space: pre-wrap;  /* garde \n et \n\n visibles */
  line-height: 1.6;
}

#site-bg-video {
  position: fixed;
  inset: 0;               /* couvre tout l'écran */
  width: 100%;
  height: 100%;
  object-fit: cover;       /* remplit sans déformer */
  z-index: -1;             /* reste derrière tout */
  opacity: 1;              /* tu peux baisser si besoin (ex: 0.6) */
  pointer-events: none;    /* ne bloque pas les clics */
}

a,
a:visited {
  color: inherit;             /* garde la couleur définie normalement */
  text-decoration: none;      /* optionnel si tu veux pas de souligné */
}

a:hover {
  color: var(--accent, #a34d57); /* survol en bordeaux */
}

.card-small {
  max-width: 400px;
  padding: 16px 20px;
  margin-top: 32px;
  font-size: 1rem;
  text-align: center;
  cursor: pointer;
  transition: transform .25s ease, box-shadow .25s ease;
}
.card-small:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 32px rgba(163,77,87,0.25);
}

.hero .bg {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;        /* ← pour les vidéos */
  filter: saturate(1.05) contrast(1.02);
}

/* dans ta modale : bloque l'overscroll pour garder le contrôle */
.modal__content {
  overscroll-behavior: contain;
}

/* Animation fade-in sur la grille */
#tarot-grid.fade-in {
  opacity: 0;
  transform: scale(0.96);
  animation: tarot-fadein 0.5s ease forwards;
}

@keyframes tarot-fadein {
  to {
    opacity: 1;
    transform: scale(1);
  }
}

/* Conteneur des boutons Offres + Newsletter */
.grid {
  display: flex;             /* aligne en ligne */
  justify-content: center;   /* centre horizontalement */
  gap: 12px;                 /* espace entre les boutons */
  flex-wrap: nowrap;         /* pas de retour à la ligne */
}

/* Boutons à l'intérieur */
.grid .btn {
  flex: 0 0 auto;            /* taille auto selon contenu */
  font-size: .95rem;
  padding: 8px 14px;
  min-height: 44px;
  border-radius: 999px;
  white-space: nowrap;
}

/* Sur mobile : boutons plus compacts */
@media (max-width: 720px) {
  .grid {
    gap: 8px;
  }
  .grid .btn {
    font-size: .85rem;
    padding: 6px 10px;
  }
}



    
  </style>
  
  
  
</head>

<body>
    
    <!-- Vidéo de fond globale -->
<video id="site-bg-video" autoplay muted loop playsinline>
  <source src="/assets/video/fond1.mp4" type="video/mp4">
</video>


  <!-- ===== Bandeau ===== -->
  <header class="topbar">
    <div class="topbar__row">
      <a class="brand" href="/" aria-label="Accueil – l’Œil d’Opanoma">
        <img src="/assets/img/hero/logo-opanoma.png" alt="Logo l’Œil d’Opanoma">
        <span class="brand__name">l’Œil d’Opanoma</span>
      </a>
      <nav class="nav" aria-label="Navigation principale">
        <a class="btn" href="#choisir">Choisir</a>
        <a class="btn" href="#reserver">Réserver</a>
        <a class="btn nav__week" href="#newsletter">Carte de la semaine</a>
      </nav>
      <div class="socials" aria-label="Réseaux sociaux">
        <a class="icon" href="https://www.instagram.com/loeil_dopanoma/" target="_blank" rel="noopener" aria-label="Instagram">
          <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
            <rect x="2" y="2" width="20" height="20" rx="5" ry="5" fill="none" stroke="currentColor" stroke-width="2"/>
            <circle cx="12" cy="12" r="4" fill="none" stroke="currentColor" stroke-width="2"/>
            <circle cx="17.5" cy="6.5" r="1.5" fill="currentColor"/>
          </svg>
        </a>
        <a class="icon" href="https://www.etsy.com/fr/shop/Loeildopanoma" target="_blank" rel="noopener" aria-label="Etsy">
          <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
            <rect x="2" y="2" width="20" height="20" rx="4" fill="none" stroke="currentColor" stroke-width="2"/>
            <path d="M8 7h8v2H10v3h5v2h-5v3h6v2H8V7Z" fill="currentColor"/>
          </svg>
        </a>
      </div>
    </div>
  </header>

<section class="hero" id="top">
  <video class="bg" autoplay muted loop playsinline aria-hidden="true">
    <source src="/assets/video/fond1.mp4" type="video/mp4">
  </video>


  <div class="hero-center">
    <div class="card">
      

      <h1 class="mega">Manon, la voix de l’intuition</h1>
      <p class="sub">
        Forte d’un héritage familial et d’une expérience grandissante, Manon met aujourd’hui son don d’interprétation au service de chacun. 
        Dans un climat d’écoute et de bienveillance, elle vous aide à clarifier vos doutes et à avancer avec confiance.
      </p>

      <div class="grid">
        <a class="btn" href="#choisir">Offres</a>
        <a class="btn" href="#newsletter">Newsletter</a>
      </div>
    </div>

    <!-- Nouveau petit cadre -->
    <!-- Petit cadre -->
<!-- Petit cadre cliquable -->
<div class="card card-small" data-open-modal="tirage-modal" style="cursor:pointer">
  <p style="margin:0">
    ✨ En attendant votre RDV,<br>
    amusez-vous avec <strong>Madame IA.RMA</strong>
  </p>
</div>


  </div>
</section>



  <!-- ===== Offres ===== -->
  <section class="wrap" id="choisir">
    <h2 class="section-title">Offres &amp; tarifs</h2>
    <div class="grid-3">
      <div class="card" data-cal="question-unique-15min">
        <h3>Question Unique</h3>
        <p class="price">15&nbsp;€</p>
        <ul class="meta">
          <li>Réponse rapide (– de 15&nbsp;min)</li>
          <li>Uniquement par téléphone</li>
          <li>L'intégrale en PDF +5&nbsp;€</li>
        </ul>
      </div>
      <div class="card" data-cal="guidance-30min">
        <h3>Guidance 30 min</h3>
        <p class="price">30&nbsp;€</p>
        <ul class="meta">
          <li>Clarification + tirage</li>
          <li>Uniquement par téléphone</li>
          <li>L'intégrale en PDF +5&nbsp;€</li>
        </ul>
      </div>
      <div class="card" data-cal="guidance-60min">
        <h3>Guidance 60 min</h3>
        <p class="price">60&nbsp;€ <small>(60&nbsp;min)</small></p>
        <ul class="meta">
          <li>Exploration approfondie</li>
          <li>Uniquement par téléphone</li>
          <li>L'intégrale en PDF +10&nbsp;€</li>
        </ul>
      </div>
      <div class="card" data-cal="soin-energetique-60min">
        <h3>Soin énergétique (présentiel)</h3>
        <p class="price">60&nbsp;€ <small>(60&nbsp;min)</small></p>
        <ul class="meta">
          <li>À domicile (zone à préciser)</li>
          <li>Rendez-vous sur demande</li>
        </ul>
      </div>
      <div class="card" data-cal="pendule-distance-30min">
        <h3>Pendule à distance</h3>
        <p class="price">30&nbsp;€</p>
        <ul class="meta">
          <li>Énergétique à distance</li>
          <li>Compte-rendu bref</li>
          <li>Livraison sous 24&nbsp;h</li>
        </ul>
      </div>
      <div class="card" data-cal="deblocage-pendule-30min">
        <h3>Déblocage (pendule)</h3>
        <p class="price">30&nbsp;€</p>
        <ul class="meta">
          <li>Travail ciblé</li>
          <li>À distance</li>
          <li>Livraison sous 24&nbsp;h</li>
        </ul>
      </div>
    </div>
  </section>
  








 

  <!-- ===== Réserver ===== -->
  <section class="wrap" id="reserver" aria-labelledby="reserver-title">
    <h2 id="reserver-title" class="section-title">Réserver</h2>
    <div class="card">
      <div class="embed-wrap">
        <iframe id="calframe" src="about:blank" title="Réservation — l’Œil d’Opanoma" loading="lazy" allow="microphone; camera"></iframe>
      </div>
    </div>
  </section>

  <!-- ===== Script Cal.com ===== -->
  <script>
  (function(){
    const CAL_MAP = {
      'question-unique-15min'  : 'https://cal.com/christophe-sebille-yps3zm/question-unique-15min',
      'guidance-30min'         : 'https://cal.com/christophe-sebille-yps3zm/guidance-30',
      'guidance-60min'         : 'https://cal.com/christophe-sebille-yps3zm/guidance-60',
      'soin-energetique-60min' : 'https://cal.com/christophe-sebille-yps3zm/soin-energetique',
      'pendule-distance-30min' : 'https://cal.com/christophe-sebille-yps3zm/pendule',
      'deblocage-pendule-30min': 'https://cal.com/christophe-sebille-yps3zm/deblocage',
    };
    const frame    = document.getElementById('calframe');
    const reserver = document.getElementById('reserver');
    function currentMonthStr(d = new Date()){ return d.toISOString().slice(0,7); }
    function openCal(slug){
      const base = CAL_MAP[slug]; if (!base) return;
      const url = new URL(base);
      url.searchParams.set('theme','light');
      url.searchParams.set('hide_event_type_details','true');
      url.searchParams.set('overlayCalendar','true');
      url.searchParams.set('month', currentMonthStr());
      if (frame) frame.src = url.toString();
      if (reserver) { reserver.style.display = 'block'; reserver.scrollIntoView({ behavior:'smooth', block:'start' }); }
    }
    document.querySelectorAll('#choisir .card[data-cal]').forEach(card=>{
      card.setAttribute('role','button'); card.setAttribute('tabindex','0');
      card.addEventListener('click', ()=> openCal(card.dataset.cal));
      card.addEventListener('keydown', (e)=>{ if (e.key==='Enter'||e.key===' '){ e.preventDefault(); openCal(card.dataset.cal); }});
    });
    console.log('[CAL] cartes détectées =', document.querySelectorAll('#choisir .card[data-cal]').length);
  })();
  </script>

  <!-- ===== Newsletter ===== -->
  <section id="newsletter" class="card-section">
    <div class="container">
        <h4>La Newsletter d'Opanoma</h4>
      <h2>La carte de la semaine</h2>
      <p>Recevez chaque mardi matin votre carte et son interprétation.</p>

      <!-- Bloc MailerLite -->
      <div id="mlb2-29644786" class="ml-form-embedContainer ml-subscribe-form ml-subscribe-form-29644786">
        <div class="ml-form-align-center">
          <div class="ml-form-embedWrapper embedForm">

            <div class="ml-form-embedBody ml-form-embedBodyDefault row-form">

              <div class="ml-form-embedContent">
                
                
              </div>

              <form class="ml-block-form"
                    action="https://assets.mailerlite.com/jsonp/1732807/forms/162808761459673022/subscribe"
                    method="post" target="_blank">
                <div class="ml-form-formContent">
                  <div class="ml-form-fieldRow ml-last-item">
                    <div class="ml-field-group ml-field-email ml-validate-email ml-validate-required">
                      <input aria-label="email" aria-required="true" type="email" class="form-control"
                             name="fields[email]" placeholder="Email" autocomplete="email">
                    </div>
                  </div>
                </div>

                <div class="ml-form-embedSubmit">
                  <button type="submit" class="primary">S'inscrire</button>
                </div>

                <input type="hidden" name="ml-submit" value="1">
                <input type="hidden" name="anticsrf" value="true">
              </form>
            </div>

            <div class="ml-form-successBody row-success" style="display:none">
              <div class="ml-form-successContent">
                <h4>Merci !</h4>
                <p>Vous êtes bien inscrit·e à la newsletter.</p>
              </div>
            </div>

          </div>
        </div>
      </div>
      <!-- Fin Bloc MailerLite -->
    </div>
  </section>

  <!-- Script MailerLite (une seule fois) -->
  <script src="https://groot.mailerlite.com/js/w/webforms.min.js" type="text/javascript"></script>
  <script>
    function ml_webform_success_29644786() {
      var $ = ml_jQuery || jQuery;
      $('.ml-subscribe-form-29644786 .row-success').show();
      $('.ml-subscribe-form-29644786 .row-form').hide();
    }
  </script>
  
  
  

<!-- ===== Modal Tirage ===== -->
<div class="modal" id="tirage-modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="tirage-modal-title">
  <div class="modal__overlay" data-close-modal="tirage-modal"></div>

  <div class="modal__panel" role="document">
    <!-- Fond vidéo de la modale -->
    <video class="panel-bg" autoplay muted loop playsinline>
      <source src="/assets/video/crystal.mp4" type="video/mp4">
    </video>

    <div class="modal__head">
      <h1 class="modal__title" id="tirage-modal-title">Madame IA.rma</h1>
    </div>

    <div class="modal__content">
      <div id="tirage-ia" class="wrap">
        <div class="tirage-content">
          <h3 id="ia-title">
            <span>1. Choix du Thème</span>
            <span>2. Question</span>
            <span>3. Choix du tirage</span>
          </h3>

          <div class="card">
            <!-- Thèmes + Question -->
            <div class="themes-row">
              <div class="themes" role="group" aria-label="Thème du tirage">
                <button class="theme" data-theme="santé"   type="button">Santé</button>
                <button class="theme" data-theme="amour"   type="button">Amour</button>
                <button class="theme" data-theme="argent"  type="button">Argent</button>
                <button class="theme" data-theme="travail" type="button">Travail</button>
              </div>

              <div id="theme-question" class="theme-question" hidden aria-live="polite">
                <div id="chosen-theme" class="chosen-theme" hidden></div>
                <label for="user-question" class="q-label">Votre question (optionnel)</label>
                <textarea id="user-question" rows="1" maxlength="200" placeholder="…"></textarea>
                <div class="q-tools">
                  <small id="q-counter">0/200</small>
                  <button type="button" id="q-clear" class="q-clear">Effacer</button>
                </div>
              </div>
            </div><!-- /.themes-row -->

            <!-- Modes -->
            <div class="modes" role="group" aria-label="Mode de tirage" style="margin:8px 0 12px">
              <button class="mode" data-mode="3" type="button">3 cartes</button>
              <button class="mode" data-mode="5" type="button">5 cartes (en croix)</button>
            </div>

            <!-- Grille des cartes -->
            <div id="tarot-grid" class="grid api-grid"></div>

            <!-- Résumé des tirages -->
            <div id="api-picks"></div>
          </div><!-- /.card -->

          <!-- Interprétation -->
          <section id="ia-reading" class="wrap">
            <div class="card">
              <h2 id="read-title">Interprétation du tirage</h2>
              <div id="reading-output">
                Choisissez un thème, posez une question (optionnel), puis tirez 3 ou 5 cartes.
              </div>
              <div class="interpret-actions">
  <button id="toggle-sound" class="btn mode" type="button" aria-pressed="true">🔈 Son : ON</button>
  <button id="reset-reading" class="btn mode" type="button">🔄 Reset</button>
  <button id="close-popup" class="btn mode" type="button">🏠 Opanoma.fr</button>
</div>

            </div>
          </section>
        </div><!-- /.tirage-content -->
      </div><!-- /#tirage-ia -->
    </div><!-- /.modal__content -->
  </div><!-- /.modal__panel -->
</div><!-- /.modal -->



    <!-- ===== Avis ===== -->
  <section class="wrap" id="avis" aria-labelledby="avis-title">
    <h2 id="avis-title" class="section-title">Avis sur Opanoma</h2>
    <div class="grid-3">
      <div class="card">
        <p style="margin:0 0 8px">✨ “J’ai adoré mon tirage, il est tombé pile quand j’en avais besoin !”</p>
        <p style="margin:0;font-weight:600">C. 36 ans</p>
        <a href="https://www.instagram.com/loeil_dopanoma/" target="_blank" rel="noopener" class="btn" style="margin-top:10px">Voir sur Instagram</a>
      </div>
      <div class="card">
        <p style="margin:0 0 8px">🔮 “Commande parfaite et guidance très douce, merci infiniment.”</p>
        <p style="margin:0;font-weight:600">M. 51 ans</p>
        <a href="https://www.etsy.com/fr/shop/Loeildopanoma#reviews" target="_blank" rel="noopener" class="btn" style="margin-top:10px">Voir sur Etsy</a>
      </div>
      <div class="card">
        <p style="margin:0 0 8px">🌙 “Chaque guidance m’apporte une clarté nouvelle et une énergie positive.”</p>
        <p style="margin:0;font-weight:600">J. 21 ans</p>
        <a href="https://www.instagram.com/loeil_dopanoma/" target="_blank" rel="noopener" class="btn" style="margin-top:10px">Voir sur Instagram</a>
      </div>
    </div>
  </section> 
        
          
      

  


<script>
window.addEventListener('DOMContentLoaded', () => {
  // Anti-doublon
  if (window.__tirageOpenerBound) return;
  window.__tirageOpenerBound = true;

  // ----- Openers ciblés -----
  const OPENERS = [
    '[data-open-modal]',                 // <button data-open-modal="tirage-modal">
    'a[href^="#tirage-modal"]',          // <a href="#tirage-modal">
    '[data-target="#tirage-modal"]',     // <button data-target="#tirage-modal">
    '[aria-controls="tirage-modal"]',    // <button aria-controls="tirage-modal">
    '#open-tirage',                      // <a id="open-tirage">
    '[data-action="open-tirage"]'        // <button data-action="open-tirage">
  ].join(',');

  const getTargetId = (el) => {
    const v1 = el.getAttribute('data-open-modal');
    if (v1 && v1 !== 'true') return v1.replace(/^#/, '');
    const href = el.getAttribute('href');
    if (href && href.startsWith('#')) return href.slice(1);
    const v2 = el.getAttribute('data-target') || el.getAttribute('aria-controls');
    if (v2) return v2.replace(/^#/, '');
    return 'tirage-modal';
  };

  const openModal = (id = 'tirage-modal') => {
    const modal = document.getElementById(id);
    if (!modal) return console.warn('[MODAL] introuvable :', id);
    modal.setAttribute('open', '');
    modal.setAttribute('aria-hidden', 'false');
    document.body.style.overflow = 'hidden';

    const grid = document.getElementById('tarot-grid');
    if (grid){
     // grid.classList.remove('disabled');
     // grid.style.pointerEvents = '';
     // grid.style.opacity = '';
    }
  };

  const setupClose = (id = 'tirage-modal') => {
    const modal = document.getElementById(id);
    if (!modal || modal.__closeBound) return;
    modal.__closeBound = true;

    modal.addEventListener('click', (e) => {
      if (!e.target.matches('[data-close="modal"], .modal__overlay')) return;
      modal.removeAttribute('open');
      modal.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
    });
  };

  // Empêche clic cartes sans thème
  document.addEventListener('click', (e) => {
    const card = e.target.closest?.('.tarot-card');
    if (!card) return;
    const APP = (window.TAROT_APP = window.TAROT_APP || {});
    const S   = (APP.state       = APP.state       || {});
    if (!S.theme) {
      e.preventDefault();
      e.stopPropagation();
      if (typeof showModesHint === 'function') showModesHint('Choisissez d’abord un thème.');
    }
  }, true);

  // Ouvrir via clic
  document.addEventListener('click', (e) => {
    const btn = e.target.closest(OPENERS);
    if (!btn) return;
    e.preventDefault();
    const id = getTargetId(btn);
    setupClose(id);
    openModal(id);
  });

  // Ouvrir via clavier (Enter/Espace)
  document.addEventListener('keydown', (e) => {
    if (e.key !== 'Enter' && e.key !== ' ') return;
    const btn = e.target.closest(OPENERS);
    if (!btn) return;
    e.preventDefault();
    const id = getTargetId(btn);
    setupClose(id);
    openModal(id);
  });

  // Helper console
  window.openTirage = () => { setupClose('tirage-modal'); openModal('tirage-modal'); };

  // ----- Autoplay vidéo du tirage (si présente) -----
  const v = document.querySelector('#tirage-ia video');
  if (v) {
    v.play().catch(() => {
      console.log('[video] autoplay bloqué → on attend un clic');
      const resume = () => { v.play().catch(()=>{}); document.removeEventListener('click', resume); };
      document.addEventListener('click', resume, { once:true });
    });
  }
});
</script>

<!-- === BOOTSTRAP TAROT (à placer avant le module IA) === -->
<script>
(() => {
  "use strict";

  // ---- ÉTAT PARTAGÉ ----
  const APP = (window.TAROT_APP = window.TAROT_APP || {});
  const S   = (APP.state       = APP.state       || {});
  S.theme    ??= null;
  S.mode     ??= null;   // pas de présélection
  S.limit    ??= 0;
  S.flips    ??= 0;
  S.selected ??= [];

  // ---- SELECTEURS ----
  const $  = (q, r=document) => r.querySelector(q);
  const $$ = (q, r=document) => Array.from(r.querySelectorAll(q));

  const grid          = $('#tarot-grid');
  const themesWrap    = $('#tirage-ia .themes');
  const modesWrap     = $('#tirage-ia .modes');
  const qBox          = $('#theme-question');
  const chosenThemeEl = $('#chosen-theme');
  const txt           = $('#user-question');
  const qCounter      = $('#q-counter');
  const qClear        = $('#q-clear');
  const picks         = $('#api-picks');
  const actions       = $('.interpret-actions');
  const readOut       = $('#reading-output');

  // ---- CARTES (déclarations uniques) ----
  const BACK_SRC  = "/assets/img/tarot/verso.webp";
  const FACE_BASE = "/assets/img/tarot/majors";
  const TAROT_FACES = [
    "00-le-mat.webp","01-le-bateleur.webp","02-la-papesse.webp","03-limperatrice.webp",
    "04-lempereur.webp","05-le-pape.webp","06-lamoureux.webp","07-le-chariot.webp",
    "08-la-justice.webp","09-lhermite.webp","10-la-roue-de-fortune.webp","11-la-force.webp",
    "12-le-pendu.webp","13-larcane-sans-nom.webp","14-temperance.webp","15-le-diable.webp",
    "16-la-maison-dieu.webp","17-letoile.webp","18-la-lune.webp","19-le-soleil.webp",
    "20-le-jugement.webp","21-le-monde.webp"
  ];
  const faceSrc = (i) => `${FACE_BASE}/${TAROT_FACES[i]}`;

  // expose pour le module IA
  window.FACE_BASE   = FACE_BASE;
  window.TAROT_FACES = TAROT_FACES;
  window.faceSrc     = faceSrc;

  // ---- UI HELPERS ----
  function setTheme(val){
    S.theme = val;
    $$('#tirage-ia .theme').forEach(b => b.classList.toggle('active', b.dataset.theme===val));
    qBox.hidden = false;
    if (chosenThemeEl){ chosenThemeEl.hidden = false; chosenThemeEl.textContent = `Thème : ${val}`; }
    readOut.textContent = "Posez votre question (optionnel), puis choisissez 3 ou 5 cartes.";
  }

  function setMode(n){
    const v = parseInt(n,10) || 3; // pas de présélection car on n’appelle setMode qu’au clic
    S.mode = v; S.limit = v; S.flips = 0; S.selected = [];
    $$('#tirage-ia .mode').forEach(b => b.classList.toggle('active', parseInt(b.dataset.mode,10)===v));
    grid?.classList.remove('disabled');
    picks.innerHTML = "";
    actions?.classList.remove('is-visible');
  }

  function updateCounter(){
    if (!qCounter || !txt) return;
    qCounter.textContent = `${(txt.value||"").length}/200`;
  }

 function buildGrid(){
  if (!grid) return;
  const N = 22;

  // on mélange les indices
  const indices = Array.from({length:N}, (_,i)=>i);
  for (let j = N-1; j>0; j--){
    const k = Math.floor(Math.random() * (j+1));
    [indices[j], indices[k]] = [indices[k], indices[j]];
  }

  const frag = document.createDocumentFragment();
  for (const i of indices){
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.className = 'tarot-card';
    btn.dataset.index = String(i);
    btn.innerHTML = `
      <span class="flip">
        <span class="side back"><img loading="lazy" src="${BACK_SRC}" alt="Dos de carte"></span>
        <span class="side front"><img loading="lazy" src="${faceSrc(i)}" alt="Arcane ${i}"></span>
      </span>`;
    frag.appendChild(btn);
  }

  grid.innerHTML = "";
  grid.appendChild(frag);
  grid.classList.add('disabled');

  // 🔮 déclenche le fade-in
  grid.classList.remove('fade-in'); // reset au cas où
  void grid.offsetWidth;            // force un reflow
  grid.classList.add('fade-in');
}




  function addPick(i){
    const card = document.createElement('div');
    card.className = 'result-card';
    card.style.setProperty('--pick-w','86px');
    card.innerHTML = `
      <div class="result-card-inner">
        <img src="${faceSrc(i)}" alt="Carte #${i}">
      </div>`;
    picks.appendChild(card);
  }

function resetTirage() {
  // État
  S.theme    = null;
  S.mode     = null;
  S.limit    = 0;
  S.flips    = 0;
  S.selected = [];

  // UI : désélectionne thèmes & modes
  $$('#tirage-ia .theme').forEach(b => b.classList.remove('active'));
  $$('#tirage-ia .mode').forEach(b => b.classList.remove('active'));

  // UI : question masquée + champs vidés
  if (qBox) qBox.hidden = true;
  if (chosenThemeEl) { chosenThemeEl.hidden = true; chosenThemeEl.textContent = ""; }
  if (txt) { txt.value = ""; }
  if (qCounter) qCounter.textContent = "0/200";

  // Picks et actions
  if (picks) picks.innerHTML = "";
  if (actions) actions.classList.remove('is-visible');

  // Message par défaut
  if (readOut) {
    readOut.classList.remove('typing');
    readOut.textContent = "Choisissez un thème, posez une question (optionnel), puis tirez 3 ou 5 cartes.";
  }

  // Grille : rebuild (mélangé) + verrou tant que pas de mode
  buildGrid();
}

// ====== TTS (Text-To-Speech) — Son ON/OFF + auto-lecture ======
const TTS = {
  synth: window.speechSynthesis,
  utter: null,
  voice: null,
  enabled: true,      // ← ON par défaut (bouton bascule)
  prewarmed: false,   // ← pour iOS/Safari (déblocage au 1er clic)
  state: "idle"       // "idle" | "speaking" | "paused"
};

function pickFrenchVoice() {
  if (!TTS.synth) return null;
  const voices = TTS.synth.getVoices() || [];
  return (
    voices.find(v => v.lang?.toLowerCase() === "fr-fr") ||
    voices.find(v => /fr/i.test(v.lang || "")) ||
    voices[0] || null
  );
}

function prewarmTTS() {
  if (!TTS.synth || TTS.prewarmed) return;
  const u = new SpeechSynthesisUtterance(" ");
  u.volume = 0; u.rate = 1; u.pitch = 1; u.lang = "fr-FR";
  try { TTS.synth.speak(u); TTS.synth.cancel(); TTS.prewarmed = true; } catch {}
}

if (TTS.synth) {
  TTS.synth.onvoiceschanged = () => { TTS.voice = pickFrenchVoice(); };
  TTS.voice = pickFrenchVoice();
}

// UI bouton ON/OFF
function updateSoundButton() {
  const b = document.getElementById("toggle-sound");
  if (!b) return;
  b.textContent = TTS.enabled ? "🔈 Son : ON" : "🔇 Son : OFF";
  b.setAttribute("aria-pressed", TTS.enabled ? "true" : "false");
}
document.getElementById("toggle-sound")?.addEventListener("click", () => {
  TTS.enabled = !TTS.enabled;
  if (!TTS.enabled) ttsStop(); else prewarmTTS();
  updateSoundButton();
});
updateSoundButton();

// Pré-débloque au 1er clic utilisateur (iOS/Safari)
document.addEventListener("click", prewarmTTS, { once: true });

function makeUtterance(text) {
  const u = new SpeechSynthesisUtterance(text);
  u.lang = "fr-FR";
  u.rate = 1.0;
  u.pitch = 1.0;
  u.volume = 1.0;
  if (!TTS.voice) TTS.voice = pickFrenchVoice();
  if (TTS.voice) u.voice = TTS.voice;

  u.onstart = () => { TTS.state = "speaking"; };
  u.onpause = () => { TTS.state = "paused";   };
  u.onresume= () => { TTS.state = "speaking"; };
  u.onend   = () => { TTS.state = "idle"; TTS.utter = null; };
  u.onerror = () => { TTS.state = "idle"; TTS.utter = null; };
  return u;
}

function ttsSpeak(text) {
  if (!TTS.synth || !TTS.enabled) return;
  if (!text?.trim()) return;
  prewarmTTS();
  try { TTS.synth.cancel(); } catch {}
  TTS.utter = makeUtterance(text);
  try { TTS.synth.speak(TTS.utter); } catch {}
}

function ttsStop() {
  if (!TTS.synth) return;
  try { TTS.synth.cancel(); } catch {}
  TTS.state = "idle";
  TTS.utter = null;
}

// Stop auto quand on reset / ferme la modale
document.getElementById("reset-reading")?.addEventListener("click", ttsStop);
document.getElementById("close-popup")?.addEventListener("click", ttsStop);

// Expose si besoin
window.TTS = TTS;
window.ttsSpeak = ttsSpeak;
window.ttsStop  = ttsStop;
window.updateSoundButton = updateSoundButton;



  // ---- BINDINGS ----
  themesWrap?.addEventListener('click', (e)=>{
    const b = e.target.closest('.theme'); if (!b) return;
    setTheme(b.dataset.theme);
  });

  modesWrap?.addEventListener('click', (e)=>{
    const b = e.target.closest('.mode'); if (!b) return;
    setMode(b.dataset.mode);
  });

  if (txt){
    txt.addEventListener('input', updateCounter);
    updateCounter();
  }
  qClear?.addEventListener('click', ()=>{
    if (!txt) return;
    txt.value = "";
    updateCounter();
    txt.focus();
  });

  grid?.addEventListener('click', (e)=>{
      ttsStop(); // 👈 stoppe la voix en cours si on lance un nouveau tirage
    const card = e.target.closest('.tarot-card');
    if (!card) return;

    if (!S.theme){
      e.preventDefault(); e.stopPropagation();
      readOut.textContent = "Choisissez d’abord un thème, puis une question (optionnel).";
      $('#tirage-ia .themes')?.classList.add('shake');
      setTimeout(()=>$('#tirage-ia .themes')?.classList.remove('shake'), 450);
      return;
    }
    if (S.flips >= S.limit) return;

    const idx = parseInt(card.dataset.index,10);
    if (card.dataset.flipped === "1") return;

    card.dataset.flipped = "1";
    S.flips++;
    S.selected.push(idx);
    addPick(idx);

    if (S.flips >= S.limit){
      actions?.classList.add('is-visible');
      window.Interpretation?.run({
        theme: S.theme,
        question: (txt?.value || "").trim(),
        mode: S.mode,
        cards: S.selected.slice()
      });
    }
  });

  $('#reset-reading')?.addEventListener('click', resetTirage);


  $('#close-popup')?.addEventListener('click', ()=>{
    const modal = document.getElementById('tirage-modal');
    if (modal){
      modal.removeAttribute('open');
      modal.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
      window.scrollTo({ top:0, behavior:'smooth' });
    } else {
      location.href = '/';
    }
  });

  // ---- INIT ----
  buildGrid();
  $$('#tirage-ia .mode').forEach(b => b.classList.remove('active')); // pas de présélection
})();
</script>




<script>

// === MODULE IA : window.Interpretation.run(...) ===
(() => {
  const APP = (window.TAROT_APP = window.TAROT_APP || {});
  const S   = (APP.state       = APP.state       || {});
  const $   = (q, r=document) => r.querySelector(q);

  // Évite double définition
  if (window.Interpretation?.run) return;

 
// --- Machine à écrire + auto-scroll progressif ---
function typeWriter(text, el, speed = 16, done = ()=>{}) {
  const myToken = (window.TAROT_APP.state._twToken = (window.TAROT_APP.state._twToken || 0) + 1);
  el.textContent = "";
  el.classList.add("typing");

  let i = 0;
  (function tick() {
    if (window.TAROT_APP.state._twToken !== myToken) return; 

    const step = (i % 5 === 0) ? 2 : 1;
    el.textContent += text.slice(i, i + step);
    i += step;

    // 👇 garde visible au fil de la frappe
    if (i % 8 === 0 || i >= text.length) {
      keepReadingVisible(el, 40);
    }

    if (i < text.length) {
      setTimeout(tick, speed);
    } else {
      el.classList.remove("typing");
      done();
    }
  })();
}


function cleanInterpretationText(text){
  if (!text) return "";
  return text
    .replace(/\*\*/g, '')           // enlève gras markdown (**…**)
    .replace(/\*/g, '')             // enlève italiques markdown (*…*)
    .replace(/_/g, '')              // enlève underscores éventuels
    .replace(/\s*\(\#?\d+\)/g, '')  // enlève (12) ou (#12)
    .replace(/[ \t]+/g, ' ')        // normalise espaces sans toucher aux \n
    .replace(/\n{3,}/g, "\n\n")     // évite trop de sauts de ligne
    .trim();
}





// --- garde la zone d'interprétation visible pendant la frappe ---
function keepReadingVisible(el, pad = 32) {
  if (!el) return;

  // si on est dans la modale, on scrolle la zone .modal__content
  const modalContent = document.querySelector('#tirage-modal[open] .modal__content');
  if (modalContent) {
    const section = document.getElementById('ia-reading') || el;
    const sectionRect = section.getBoundingClientRect();
    const contentRect = modalContent.getBoundingClientRect();

    const visibleBottom = contentRect.top + modalContent.clientHeight;
    const needed = sectionRect.bottom + pad - visibleBottom;
    if (needed > 0) {
      modalContent.scrollTop += needed; // pas d'animation ici pour éviter les saccades
    }
    return;
  }

  // sinon on scrolle la fenêtre
  const needed = el.getBoundingClientRect().bottom + pad - window.innerHeight;
  if (needed > 0) {
    window.scrollBy({ top: needed, behavior: 'auto' }); // 'auto' = fluide sans accumuler les animations
  }
}


  // --- Focus + scroll vers l’interprétation ---
function focusReading() {
  const section = document.getElementById('ia-reading') || document.getElementById('reading-output');
  if (!section) return;

  // cible la zone scrollable de la modale si ouverte
  const modalContent = document.querySelector('#tirage-modal[open] .modal__content');
  const header       = document.querySelector('.topbar');

  // Rendre le titre focusable et mettre le focus sans jump
  const title = document.getElementById('read-title') || section;
  if (title && !title.hasAttribute('tabindex')) title.setAttribute('tabindex','-1');
  title?.focus({ preventScroll: true });

  if (modalContent) {
    // scroll interne dans la modale
    const targetTop =
      section.getBoundingClientRect().top
      - modalContent.getBoundingClientRect().top
      + modalContent.scrollTop
      - 8;

    modalContent.scrollTo({ top: Math.max(0, targetTop), behavior: 'smooth' });
  } else {
    // fallback : scroll fenêtre
    const offset = (header?.offsetHeight || 80) + 8;
    const y = section.getBoundingClientRect().top + window.pageYOffset - offset;
    window.scrollTo({ top: y, behavior: 'smooth' });
  }
}

function renderInterpretation(rawText, outEl, actionsEl){
  // Nettoie
  const cleaned = cleanInterpretationText(rawText);

  // Machine à écrire avec scroll progressif
  typeWriter(cleaned, outEl, 16, () => {
    actionsEl?.classList.add('is-visible');
    focusReading(); // recentre une fois à la fin
  });

  // 🔊 TTS si activé
  try {
    updateSoundButton?.();
    if (window.TTS?.enabled) ttsSpeak(cleaned);
  } catch {}
}


  // (optionnel) dispo côté bootstrap
  window.focusReading = focusReading;

  // Cartes (provenant du bootstrap)
  const FACE_BASE   = window.FACE_BASE;
  const TAROT_FACES = window.TAROT_FACES;

  // Libellés lisibles pour le backend (name/label)
  const TAROT_LABELS = [
    "Le Mat","Le Bateleur","La Papesse","L’Impératrice",
    "L’Empereur","Le Pape","L’Amoureux","Le Chariot",
    "La Justice","L’Hermite","La Roue de Fortune","La Force",
    "Le Pendu","L’Arcane Sans Nom","Tempérance","Le Diable",
    "La Maison Dieu","L’Étoile","La Lune","Le Soleil",
    "Le Jugement","Le Monde"
  ];

  window.Interpretation = window.Interpretation || {};
  window.Interpretation.run = async function({ theme, question, mode, cards }){
    const out     = $('#reading-output');
    const actions = document.querySelector('.interpret-actions');
    if (!out) return;

    // Accessibilité
    out.setAttribute('role','status');
    out.setAttribute('aria-live','polite');

    // Anti double-lancement
    if (S._iaRunning) return;
    S._iaRunning = true;

    try {
      // UI: loader + scroll
      out.classList.add('typing');
      out.innerHTML = `<div class="loader">
        <span class="spinner"></span><span>Madame IA réfléchit…</span>
      </div>`;
      focusReading();

      // --- Validations front ---
      const THEMES_OK = ["santé","amour","argent","travail"];
      if (!THEMES_OK.includes(theme)) throw new Error("Thème invalide");
      if (![3,5].includes(+mode))     throw new Error("Mode invalide");
      if (!Array.isArray(cards) || cards.length !== +mode) throw new Error("Nombre de cartes incohérent");
      const uniq = new Set(cards);
      if (uniq.size !== cards.length) throw new Error("Cartes en doublon");
      if (!cards.every(n => Number.isInteger(n) && n >= 0 && n <= 21)) throw new Error("Index carte hors limites");

      // --- Objets cartes pour le backend ---
      const cards_objects = cards.map((i) => ({
        name: TAROT_LABELS[i],
        label: TAROT_LABELS[i],
        number: i,
        reversed: false,
        url: `${FACE_BASE}/${TAROT_FACES[i]}`,
        slug: TAROT_FACES[i]
      }));

      // --- Positions ---
      const POS_3_FR = ["passé","présent","futur"];
      const POS_5_FR = ["situation","blocage","ressources","évolution","synthèse"];
      const POS_3_EN = ["past","present","future"];
      const POS_5_EN = ["situation","challenge","resources","outcome","synthesis"];
      const positions_fr = (+mode === 3) ? POS_3_FR : POS_5_FR;
      const positions_en = (+mode === 3) ? POS_3_EN : POS_5_EN;

      // --- Payload attendu par ton PHP ---
      const payload = {
        theme,
        question: (question || "").slice(0, 200),
        mode: +mode,
        cards: cards_objects, // objets, pas indices
        positions: positions_fr,
        positions_en,
        cards_positions: cards_objects.map((c, idx) => ({
          ...c, position: positions_fr[idx], position_en: positions_en[idx]
        })),
        mode_name: (+mode===3 ? "3-cards" : "cross-5")
      };

      console.debug('[IA] payload', payload);

      // --- Appel de l’API PHP ---
      const res = await fetch("/api/tarot/summarize/index.php", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Accept": "application/json",
          "X-Requested-With": "XMLHttpRequest"
        },
        body: JSON.stringify(payload)
      });

      // Lis réponse (json ou texte) & gestion d’erreurs verbeuse
      let data, raw = "";
      const ct = res.headers.get("content-type") || "";
      if (ct.includes("application/json")) data = await res.json(); else raw = await res.text();

      if (!res.ok) {
        const msg = (data && (data.error || data.message)) || raw || `HTTP ${res.status}`;
        throw new Error(msg);
      }

      const finalText = (data && (data.text || data.result || data.message)) || raw || "";
if (!finalText) throw new Error("Réponse vide");


const cleanedText = cleanInterpretationText(finalText);

// --- Affichage en machine à écrire + scroll + actions visibles ---
typeWriter(cleanedText, out, 16, () => {
  actions?.classList.add('is-visible');
  focusReading();
  out.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
});

// 🔊 Auto-lecture si le son est ON
updateSoundButton?.();
ttsSpeak(cleanedText);


console.debug('[IA] response ok', data || raw);

} catch (err) {
  console.error("[IA] erreur", err);

  // Affiche l’erreur en machine à écrire + scroll
  typeWriter("⚠️ " + (err?.message || "Erreur d’interprétation. Réessayez."), out, 12, () => {
    actions?.classList.add('is-visible');

    focusReading();
    out.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
  });

} finally {
  S._iaRunning = false;
}
};
})();
</script>
</body>
</html>

